---
title: "spheniscus"
description: |
  An R package to clean TDR data and calculate diving trip parameters during foraging trips.| Un paquete para limpiar datos de TDR y calcular parametros de buceo durante los viajes de alimentaci贸n. 
author:
  - name: Miriam Lerma
date: 2021-05-15
output:
  distill::distill_article:
    toc: true
    toc_depth: 2
    self_contained: false
---

```{r, echo=FALSE, out.width = "40%"}
knitr::include_graphics("https://raw.githubusercontent.com/MiriamLL/spheniscus/master/man/figures/logo.png")
```

# Intro

El objetivo de este paquete es:  
- Hacer disponibles datos crudos de TDR para que se familiaricen con el formato.  
- Ayudarte a limpiar los datos de TDR para obtener par谩metros de buceo de los animales muestreados.  


# Instalaci贸n 

El paquete estar谩 disponible solo por GitHub 

```{r, eval=FALSE}
install.packages("devtools")
devtools::install_github("MiriamLL/spheniscus")
```

```{r example}
library(spheniscus)
```

# Datos

## TDR_raw 

Agrega los datos crudos como objeto. 

```{r, eval=FALSE}
TDR_raw<-TDR_raw
```

Las columnas no est谩n separadas ya que primero hay que cortar partes del archivo. <br>

## TDR_dives た

Incluye todos los buceos durante el viaje. <br>

```{r, eval=FALSE}
TDR_dives<-TDR_dives
```


# Funciones

## extract_rawdata Ч

Extrae la informaci贸n de profundidad de los datos crudos de los dispositivos.  <br>
En los dispositivos TDR (Cefas G5+) la presi贸n se empieza a medir despu茅s de 'Data Block 1' y termina de medir presi贸n cuando empieza 'Data Block 2'.  Estos nombres fueron usados como separadores en row_start y row_end. Si tu dispositivo usa otros separadores como por ejemplo 'Data Block 0' hay que ajustar acorde.<br>

```{r, eval=FALSE}
TDR_pressure<-extract_pressure(data=TDR_raw, 
                          row_start='Data Block 1', 
                          row_end = 'Data Block 2')
```

## extract_trip 锔

Corta periodos de tiempo de acuerdo a nuestro inter茅s. <br>
La informaci贸n se obtuvo de dispositivos GPS, trip_start es cuando salieron de la colonia y trip_end cuando regresaron.  
Los datos fueron recortados para incluir s贸lo informaci贸n durante el viaje de alimentaci贸n.  

```{r, eval=FALSE}
TDR_trip<-extract_trip(data=TDR_pressure,
                   timeformat="%d-%m-%Y %H:%M:%S",
                   trip_start="30-11-2018 20:43:24",
                   trip_end="01-12-2018 20:16:19")
```

## plot_depth 

Crea un grafico con el perfil de buceos. Marca el cero con una linea roja. <br>
El objetivo de este gr谩fico es que te permita decidir si debes corregir el cero. 

```{r, eval=TRUE, fig.height=2}
plot_depth(TDR_trip = TDR_trip,
                   depth_column='Pressure',
                   time_column='daytime')
```


## correct_zero 

Esta funci贸n te permite corregir el cero usando un factor de correcci贸n. <br>
En el ejemplo, correg铆 el cero usando -0.80 m. Este valor fue ajustado de manera manual.  

```{r,eval=FALSE}
TDR_corrected<-correct_zero(TDR_trip = TDR_trip,
             depth_column='Pressure',
             extra_correction=-0.80)
```

Puedes volver a crear el gr谩fico para confirmar que se corrigi贸 el cero.  

```{r, fig.height=2}
plot_depth(TDR_trip = TDR_corrected,
            depth_column='corrected_depth',
            time_column='daytime')
```

## identify_dives 

Esta funci贸n identifica identifica cada buceo como unidades individuales, y les asigna a cada inmersi贸n un numero, una profundidad media de buceo, una profundidad m谩xima de buceo, una duraci贸n media de buceo y una duraci贸n m谩xima de buceo.  
En el ejemplo, los buceos reales fueron considerados cuando el animal se encontraba m谩s profundo de 3 metros.

```{r, eval=FALSE}
TDR_dives<-identify_dives(TDR_corrected=TDR_corrected,
               real_dives=3,
               depth_column='corrected_depth')
```

## dive_parameters た

Esta funci贸n calcula los par谩metros del viaje completo.  
Incluye:  
- promedio de la profundidad m谩xima de buceo,  
- desviaci贸n est谩ndar de la profundidad m谩xima de buceo,  
- el m谩ximo de profundidad, la duraci贸n promedio de los buceos,  
- la desviaci贸n est谩ndar de la duraci贸n de los buceos, y  
- la duraci贸n m谩xima de buceo, as铆 como  
- el total de buceos durante el viaje.  
**Nota** La profundidad de buceo se da en metros, la duraci贸n en segundos.

```{r}
dive_parameters<-calculate_diveparams(TDR_dives)
```

```{r, echo=FALSE}
knitr::kable(dive_parameters)
```

# Citation

Este script acompa帽a una publicaci贸n en ping眉inos por Lerma et al. (en preparaci贸n)  

Si quieres dar atribuci贸n:  
Lerma, M (2021). Package spheniscus (Version v1.0). Zenodo. http://doi.org/10.5281/zenodo.4709837 

[![DOI](https://zenodo.org/badge/360213200.svg)](https://zenodo.org/badge/latestdoi/360213200)


