---
title: "sula"
description: |
  An R package to clean your GPS data and to calculate some trip parameters. | Un paquete para editar datos de GPS y calcular parametros de los viajes de alimentaciÃ³n. 
author:
  - name: Miriam Lerma
date: 2021-05-15
output:
  distill::distill_article:
    toc: true
    toc_depth: 2
    self_contained: false
---

```{r, echo=FALSE, out.width = "40%"}
knitr::include_graphics("https://raw.githubusercontent.com/MiriamLL/sula/main/man/figures/logo.png")
```

# Intro

Este paquete contiene:  
- **Datos** de tracks de kena (_Sula dactylatra_) colectados en Rapa Nui para replicar los ejemplos ğŸ—¿  
- **Trece funciones** para limpiar y calcular parÃ¡metros de viajes a partir de datos GPS


**[Link for english](https://github.com/MiriamLL/sula).**

## InstalaciÃ³n ğŸ¤–

Puedes instalar este paquete desde [GitHub](https://github.com/) usando:

```{r, eval=FALSE}
# install.packages("devtools")
devtools::install_github("MiriamLL/sula")
```

# Datos

Carga la librerÃ­a

```{r libreria}
library(sula)
```

## Un individuo ğŸ’ƒğŸ½

Carga los datos de GPS de un individuo.  

```{r cargar_uno, eval=FALSE}
head(GPS_01)
```

**Nota** Incluye columna con fecha y hora en formato POSIXct

## Multiples individuos ğŸ‘¯â€

Carga los datos de GPS de diez individuos.  

```{r cargar_diez, eval=FALSE}
head(GPS_raw)
```

**Nota** Son datos en crudo por lo que las horas no estÃ¡n corregidas.

## Notas de campo âœï¸

Incluye el periodo cuando se colocÃ³ el dispositivo hasta cuando se retirÃ³.  


```{r, eval=FALSE}
Notas<-Notas
```

**Nota**: no corresponden al periodo real de muestreo. Se proveen estos datos para practicar las funciones.


# Funciones

## ajustar_hora ğŸ•  

Esta funciÃ³n corrige el tiempo de acuerdo a la zona horaria, se necesita especificar los datos GPS, el nombre de la columna que contiene datos de hora y dÃ­a, el formato en el que estÃ¡n Ã©stos datos, y el nÃºmero de horas de diferencia a corregir de acuerdo al GMT.

```{r, eval=FALSE}
GPS_gmt<-ajustar_hora(GPS_data = GPS_raw,
                      dia_col = 'DateGMT',
                      hora_col = 'TimeGMT',
                      formato="%d/%m/%Y %H:%M:%S",
                      dif_hor = 5)
```

Regresa el mismo data frame con dos columnas adicionales: **dia_hora** con el dÃ­a y fecha original y **hora_corregida** con la hora correspondiente al GMT.  

## recortar_periodo âœ‚ï¸

Este funciÃ³n permite recortar periodos dentro de los datos.

```{r, eval=FALSE}
GPS_recortado<-recortar_periodo(GPS_data=GPS_01,
                                inicio='02/11/2017 18:10:00',
                                final='05/11/2017 14:10:00',
                                dia_col='DateGMT',
                                hora_col='TimeGMT',
                                formato="%d/%m/%Y %H:%M:%S")
```

Nota: El formato de tiempo y hora debe ser el mismo formato que el formato de inicio y final.

## localizar_nido ğŸ£

Esta funciÃ³n usa el primer valor de los datos de GPS como punto de la colonia, sirve para identificar la localizaciÃ³n del nido por individuo. Regresa un nuevo data frame con dos columnas: Latitude y Longitude correspondientes a la localizaciÃ³n del nido. 

```{r, eval=FALSE}
nest_loc<-localizar_nido(GPS_data = GPS_01,
                          lat_col="Latitude",
                          lon_col="Longitude")
```


**Nota** Asume que los datos del nido corresponde al primer registro de GPS.


## identificar_viajesï¸ğŸ›©ï¸

Esta funciÃ³n agrega una columna de acuerdo a distancia de la colonia para determinar si esta en un viaje de alimentaciÃ³n o no. 

```{r, echo=TRUE, eval=FALSE, warnings=FALSE}
GPS_trip<-identificar_viajes(GPS_data=GPS_01,
                        nest_loc=nest_loc,
                        distancia_km=1)
```

En la columna llamada trip:  
**N**=dentro de la distancia considerada como no viaje de alimentaciÃ³n, y  
**Y**=viaje de alimentaciÃ³n.

## contar_viajes ğŸ§®

Esta funciÃ³n agrega una columna con el nÃºmero del viaje y elimina locaciones dentro de el radio de la colonia.

```{r, echo=TRUE, eval=FALSE, warnings=FALSE}
GPS_edited<-contar_viajes(GPS_data=GPS_trip)
```

## dist_colonia ğŸ“

Agrega una columna con la distancia de la colonia de cada punto.  Regresa el mismo data frame con una nueva columna llamada 'maxdist_km.

```{r, echo=TRUE, eval=FALSE, warnings=FALSE}
GPS_dist<-dist_colonia(GPS_data = GPS_edited, 
                       nest_loc=nest_loc)
```

**Nota** usa CRS: 4326. Enlaces: [Â¿referencia geogrÃ¡fica?](https://mgimond.github.io/Spatial/chp09-0.html), [Â¿cual usar?](https://geocompr.robinlovelace.net/reproj-geo-data.html)


## dist_puntos ğŸ“

Agrega una columna con la distancia entre cada punto.  Regresa el mismo data frame con una nueva columna llamada 'pointsdist_km'.

```{r, echo=TRUE, eval=FALSE, warnings=FALSE}
GPS_dist<-dist_puntos(GPS_data = GPS_edited)
```

**Nota** usa CRS: 4326. Incluye NAs al inicio del viaje. Enlaces: [Â¿referencia geogrÃ¡fica?](https://mgimond.github.io/Spatial/chp09-0.html), [Â¿cual usar?](https://geocompr.robinlovelace.net/reproj-geo-data.html)

## calcular_duracion â³

Identifica el inicio y el final del viaje y calcula la duraciÃ³n.  Regresa un nuevo data frame con 4 columnas: trip_id, trip_start, trip_end y duration.

```{r, eval=FALSE}
duracion<-calcular_duracion(GPS_data = GPS_edited,
                              col_diahora = "tStamp",
                              formato = "%Y-%m-%d %H:%M:%S",
                              unidades="hours")
```

**Nota** la duraciÃ³n se calcula en valores nÃºmericos.


## calcular_totaldist ğŸ“

Calcula distancia recorrida de la colonia por viaje.  
Debe contener la columna Longitude y Latitude con estos nombres.  
Regresa un nuevo data frame con la distancia total recorrida por viaje.

```{r, eval=FALSE}
totaldist_km<-calcular_totaldist(GPS_edited = GPS_edited)
```

## calcular_maxdist ğŸ“

Obtiene la distancia mÃ¡xima de la colonia por viaje.  
Debe contener la columna Longitude y Latitude con estos nombres.  
Regresa un nuevo data frame con la distancia mÃ¡xima de la colonia por viaje. 

```{r, eval=FALSE}
maxdist_km<-calcular_maxdist(GPS_data = GPS_edited, nest_loc=nest_loc)
```

## calcular_tripparams ğŸ“â³ğŸ“

Calcula la duraciÃ³n de los viajes, la distancia mÃ¡xima de la colonia y la distancia total recorrida.  Regresa un nuevo data frame con los parÃ¡metros por viaje. 

```{r, eval=FALSE}
trip_params<-calcular_tripparams(GPS_data = GPS_edited,
                              col_diahora = "tStamp",
                              formato = "%Y-%m-%d %H:%M:%S",
                              nest_loc=nest_loc)
```


## recortar_por_ID  âœ‚ï¸âœ‚ï¸âœ‚ï¸

Puedes recortar periodos en los viajes.  
Para el ejemplo hay que tener dos data frames:  
Uno con los **datos de GPS** incluyendo las columnas DateGMT,TimeGMT y IDs.  
Si no tienen estos nombres favor de renombrarlas.  
El otro data frame son los **datos de campo** y deben incluir las columnas "IDs", 'Hora_inicio' y "Hora_final".   
Si no tienen esos nombres favor de renombrarlas.

```{r,eval=FALSE}
GPS_recortados<-recortar_por_ID(GPS_data=GPS_raw,
                                Notas=Notas,
                                formato="%d/%m/%Y %H:%M:%S")
```

## localizar_nidos ğŸ£ğŸ£ğŸ£

Esta funciÃ³n asume que los datos del nido corresponde al primer registro de GPS y regresa las coordenadas de los nidos para cada individuo. 

```{r, eval=FALSE}
Nidos_df<-localizar_nidos(GPS_data=GPS_raw,
                         lon_col="Longitude",
                         lat_col="Latitude",
                         ID_col="IDs")
```

## preparar_varios ğŸ”ŒğŸ”ŒğŸ”Œ

Esta funciÃ³n sirve para preparar los datos antes de calcular parÃ¡metros por individuo.  
En la funciÃ³n especifica: el nombre de tu data frame, el nombre de la columna de los ID (identificadores por individuo), el nombre de la columna de la longitud y el nombre de la columna de la latitud. Para elegir los viajes elige un buffer de fuera de la colonia (distancia_km). Elige tambiÃ©n tu sistema de referencia geogrÃ¡fica. 

```{r, eval=FALSE}
GPS_preparado<-preparar_varios(GPS_data=GPS_raw,
                               ID_col="IDs",
                               lon_col="Longitude",
                               lat_col="Latitude",
                               distancia_km=1,
                               sistema_ref="+init=epsg:4326")
```

**Nota** que al usar esta funciÃ³n aparecerÃ¡n warnings. Estos warnings advierten sobre la transformaciÃ³n del objeto espacial.  

Enlaces: [Â¿referencia geogrÃ¡fica?](https://mgimond.github.io/Spatial/chp09-0.html), [Â¿cual usar?](https://geocompr.robinlovelace.net/reproj-geo-data.html)


## tripparams_varios ğŸ“ğŸ“ğŸ“

Para calcula parÃ¡metros de viajes de varios individuos especifica el nombre de la columna que contiene los identificadores por individuo, el nombre de la columna que contiene informaciÃ³n nÃºmero del viaje y el nombre de la columna que contiene informaciÃ³n del dÃ­a y hora en formato POSTIXct.

```{r, eval=FALSE}
trip_params<-tripparams_varios(GPS_data=GPS_preparado,
                               col_ID = "IDs",
                               col_tripnum="trip_number",
                               ol_diahora="hora_corregida")
```


**Nota** para usar esta funciÃ³n tus datos deben tener una columna dÃ­a y hora, si no es asÃ­, puedes hacerlo de manera manual o usar la funciÃ³n **ajustar_hora** de este paquete y poner 0 en la diferencia horaria.

```{r, eval=FALSE}
GPS_preparado<-ajustar_hora(GPS_data = GPS_preparado,
                            dif_hor = 0,
                            dia_col = 'DateGMT',
                            hora_col = 'TimeGMT',
                            formato="%d/%m/%Y %H:%M:%S")
```

# Citar

Los datos de prueba vienen de esa publicaciÃ³n. ğŸ”“
- Lerma M, Dehnhard N, Luna-Jorquera G, Voigt CC, Garthe S (2020) Breeding stage, not sex, affects foraging characteristics in masked boobies at Rapa Nui. Behavioral ecology and sociobiology 74: 149. 

- Lerma M (2021) Package sula. Zenodo. http://doi.org/10.5281/zenodo.4682898 

[![DOI](https://zenodo.org/badge/354821022.svg)](https://zenodo.org/badge/latestdoi/354821022)



