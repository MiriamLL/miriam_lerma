---
title: "sula"
description: |
  An R package to clean your GPS data and to calculate some trip parameters.
author:
  - name: Miriam Lerma
date: 2021-03-16
output:
  distill::distill_article:
    toc: true
    toc_depth: 2
    self_contained: false
---

```{r, echo=FALSE, out.width = "20%"}
knitr::include_graphics("https://raw.githubusercontent.com/MiriamLL/sula/main/man/figures/logo.png")
```

# Intro

This packages contains: <br>  
- **Tracking data** from Masked boobies _(Sula dactylatra)_ colected at Easter Island.  
- **Functions** to clean your data and calculate the foraging trip parameters of the individuals.

**[Enlace en espa√±ol](https://github.com/MiriamLL/sula).**

# Functions

## ajustar_hora üïê  

This function allows you to correct the time of the GPS according to your GMT. 
You need to provide your data frame, the name of you columns containing time and date, the format of those columns and the time difference between the data and your GMT. It returns hora_corregida with the corrected time.  

```{r, eval=FALSE}
GPS_gmt<-ajustar_hora(GPS_data = GPS_raw,
                      dia_col = 'DateGMT',
                      hora_col = 'TimeGMT',
                      formato="%d/%m/%Y %H:%M:%S",
                      dif_hor = 5)
```

## recortar_periodo ‚úÇÔ∏è

This function allows you to cut specific periods in your data. Inicio means start, Final means end.  

```{r, eval=FALSE}
GPS_recortado<-recortar_periodo(GPS_data=GPS_01,
                                inicio='02/11/2017 18:10:00',
                                final='05/11/2017 14:10:00',
                                dia_col='DateGMT',
                                hora_col='TimeGMT',
                                formato="%d/%m/%Y %H:%M:%S")
```


## localizar_nido üê£

This functions identifies the location of the nest assuming that the first column is the nest location. 

```{r, eval=FALSE}
nest_loc<-localizar_nido(GPS_data = GPS_01,
                          lat_col="Latitude",
                          lon_col="Longitude")
```

## identificar_viajesÔ∏èüõ©Ô∏è

This function adds a column with the distance from the nest, and a column to let you know if the location corresponds to a foraging trip or not. You need to give a buffer in **distancia_km**.

```{r, echo=TRUE, eval=FALSE, warnings=FALSE}
GPS_trip<-identificar_viajes(GPS_data=GPS_01,
                        nest_loc=nest_loc,
                        distancia_km=1)
```

## contar_viajes üßÆ

This function gives a number to each trip and eliminates the locations that do not correspond to trips.

```{r, echo=TRUE, eval=FALSE, warnings=FALSE}
GPS_edited<-contar_viajes(GPS_data=GPS_trip)
```

## dist_colonia üìè

This function calculates the distance from the colony of each location. Returns a new column called 'maxdist_km'.

```{r, echo=TRUE, eval=FALSE, warnings=FALSE}
GPS_dist<-dist_colonia(GPS_data = GPS_edited, 
                       nest_loc=nest_loc)
```

## dist_puntos üìê

This function calculates the distance between each location. Returns a new column called 'pointsdist_km'.

```{r, echo=TRUE, eval=FALSE, warnings=FALSE}
GPS_dist<-dist_puntos(GPS_data = GPS_edited)
```

## calcular_duracion ‚è≥

This function calculates the duration of each trip. Returns a new data frame with four columns: trip_id, trip_start, trip_end y duration.

```{r, eval=FALSE}
duracion<-calcular_duracion(GPS_data = GPS_edited,
                              col_diahora = "tStamp",
                              formato = "%Y-%m-%d %H:%M:%S",
                              unidades="hours")
```

## calcular_totaldist üìê

This function calculates the total distance travelled by each trip. 

```{r, eval=FALSE}
totaldist_km<-calcular_totaldist(GPS_edited = GPS_edited)
```

## calcular_maxdist üìè

This function calculates the maximum distance of each foraging trip. 

```{r, eval=FALSE}
maxdist_km<-calcular_maxdist(GPS_data = GPS_edited, nest_loc=nest_loc)
```

## calcular_tripparams üìê‚è≥üìè

Calculates trip duration, total distance from the colony and maximum distance and returns a data frame with the information. 

```{r, eval=FALSE}
trip_params<-calcular_tripparams(GPS_data = GPS_edited,
                              col_diahora = "tStamp",
                              formato = "%Y-%m-%d %H:%M:%S",
                              nest_loc=nest_loc)
```


## recortar_por_ID  ‚úÇÔ∏è‚úÇÔ∏è‚úÇÔ∏è

This function allows you to cut specific periods in your data using a data frame with field information (notas).

```{r,eval=FALSE}
GPS_recortados<-recortar_por_ID(GPS_data=GPS_raw,
                                Notas=Notas,
                                formato="%d/%m/%Y %H:%M:%S")
```

## localizar_nidos üê£üê£üê£

This functions identifies the location of the nest from several individuals assuming that the first column is the nest location. 

```{r, eval=FALSE}
Nidos_df<-localizar_nidos(GPS_data=GPS_raw,
                         lon_col="Longitude",
                         lat_col="Latitude",
                         ID_col="IDs")
```

## preparar_varios üîåüîåüîå

This functions adds the columns: maximum distance from the colony per location, distance between locations,  trip number. 

```{r, eval=FALSE}
GPS_preparado<-preparar_varios(GPS_data=GPS_raw,
                               ID_col="IDs",
                               lon_col="Longitude",
                               lat_col="Latitude",
                               distancia_km=1,
                               sistema_ref="+init=epsg:4326")
```

## tripparams_varios üìêüìêüìê

This function calculates trip parameters for several individuals. 

```{r, eval=FALSE}
trip_params<-tripparams_varios(GPS_data=GPS_preparado,
                               col_ID = "IDs",
                               col_tripnum="trip_number",
                               ol_diahora="hora_corregida")
```


If you dont have a column in POSTIxct format you can use this function to correct time but use 0. 

```{r, eval=FALSE}
GPS_preparado<-ajustar_hora(GPS_data = GPS_preparado,
                            dif_hor = 0,
                            dia_col = 'DateGMT',
                            hora_col = 'TimeGMT',
                            formato="%d/%m/%Y %H:%M:%S")
```

# Citation

The data comes from this publications. üîì
- Lerma M, Dehnhard N, Luna-Jorquera G, Voigt CC, Garthe S (2020) Breeding stage, not sex, affects foraging characteristics in masked boobies at Rapa Nui. Behavioral ecology and sociobiology 74: 149. 

- Lerma M (2021) Package sula. Zenodo. http://doi.org/10.5281/zenodo.4682898 

[![DOI](https://zenodo.org/badge/354821022.svg)](https://zenodo.org/badge/latestdoi/354821022)



